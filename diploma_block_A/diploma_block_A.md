# Курсовая работа блока А "Настройки и справочники"

## Описание задачи
Создать конфигурацию "Управление ИТ-фирмой" с базовым набором справочников, поддерживающую управление пользователями ИБ в режиме Предприятия.

## Результат [Выгрузка ИБ](https://github.com/MikeMadudin/onec_diploma/blob/main/diploma_block_A/%D0%92%D1%8B%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0%D0%94%D0%B8%D0%BF%D0%BB%D0%BE%D0%BC%D0%91%D0%BB%D0%BE%D0%BAA.dt)

## Реализовано:
__Справочники__:
- Справочник `Контрагенты`:
  - форма элемента, в которой КПП доступен только для контрагентов-юридических лиц. Доступность отрабатывается как при изменении типа, так и при перечитывании элемента справочника из ИБ. При изменении наименования полное наименование заполняется с разворачиванием распространенных сокращений организационно-правовых форм (АО в Акционерное общество, ОАО в Открытое Акционерное общество и тд). Реализована проверка корректности ИНН как для физических, так и для юридических лиц. Проверяется при попытке записи и при изменении ИНН.
  - в модуле объекта определено заполнение по умолчанию: тип - Юридическое лицо, ответственный - текущий сотрудник из параметра сеанса ТекущийСотрудник.

- Справочник `Сотрудники`:
  - в модуле менеджера переопределено получение формы объекта в зависимости от права доступа "Администрирование".
  - форма элемента ФормаАдминистратора для расширенного редактирования пользователей. Форма открывается для пользователей с правом доступа "Администрирование". Реализована команда "Случайный пароль", генерирующая случайный пароль и показывающая его пользователю. При записи сотрудника из этой формы выполняется:
    - создание пользователя ИБ с ролью БазовыеПрава;
    - изменение его пароля и имени для входа;
    - при снятии флажка ВходРазрешен - отключение стандартной аутентификации.

__Константа и функциональная опция__ `ВестиРасчетЗарплаты`:
- константа не присутствует в командном интерфейсе.
- в состав ФО входят зарплатные реквизиты справочника Сотрудники, а константа присутствует флажком в общей форме НастройкаПрограммы.

__Общая форма и общая команда__ `НастройкаПрограммы`:
- форма содержит основной реквизит типа НаборКонстант и поле флажка для константы ВестиРасчетЗарплаты.
- общая команда открывает общую форму и присутствует в командном интерфейсе раздела "Настройки".

__Параметр сеанса__ `ТекущийСотрудник`:
- заполняется элементом справочника Сотрудники, идентификатор пользователя ИБ которого совпадает с идентификатором текущего пользователя ИБ.

__Роли__ `БазовыеПрава` и `ПолныеПрава`:
- Роль ПолныеПрава дает права на все, кроме интерактивного удаления элементов справочников, пометки на удаление и удаления помеченных предопределенных элементов справочников.
- Роль БазовыеПрава дает права на чтение, просмотр и ввод по строке всех данных. Редактирование, добавление и изменение разрешается только для справочника Контрагенты. Роль не дает права на открытие настроек программы.

__Функции__:

Функция для проверки корректности ИНН для физических и для юридических лиц:
```bsl
Функция ИННВерен(ИНН)
	
	Если СтрДлина(ИНН) = 10 Тогда
		
		ПроверяемыйИНН = Новый Массив;
		Для Н = 1 По СтрДлина(ИНН) Цикл
			ПроверяемыйИНН.Добавить(Сред(ИНН, Н, 1));	
		КонецЦикла;
		
		КонтрольнаяСумма = 2*ПроверяемыйИНН[0] + 4*ПроверяемыйИНН[1] + 10*ПроверяемыйИНН[2] + 3*ПроверяемыйИНН[3] + 5*ПроверяемыйИНН[4]
		                 + 9*ПроверяемыйИНН[5] + 4*ПроверяемыйИНН[6] + 6*ПроверяемыйИНН[7] + 8*ПроверяемыйИНН[8];
		
		КонтрольныйРазряд = (КонтрольнаяСумма % 11) % 10;
		
		Если КонтрольныйРазряд = Число(ПроверяемыйИНН[9]) Тогда
			Возврат Истина;	
		Иначе
			Возврат Ложь;
		КонецЕсли;
		
	ИначеЕсли СтрДлина(ИНН) = 12 Тогда
		
		ПроверяемыйИНН = Новый Массив;
		Для Н = 1 По СтрДлина(ИНН) Цикл
			ПроверяемыйИНН.Добавить(Сред(ИНН, Н, 1));	
		КонецЦикла;
		
		КонтрольнаяСумма1 = 7*ПроверяемыйИНН[0] + 2*ПроверяемыйИНН[1] + 4*ПроверяемыйИНН[2] + 10*ПроверяемыйИНН[3]
                      + 3*ПроверяемыйИНН[4] + 5*ПроверяемыйИНН[5] + 9*ПроверяемыйИНН[6] + 4*ПроверяемыйИНН[7] 
                      + 6*ПроверяемыйИНН[8] + 8*ПроверяемыйИНН[9];
						
		КонтрольнаяСумма2 = 3*ПроверяемыйИНН[0] + 7*ПроверяемыйИНН[1] + 2*ПроверяемыйИНН[2] + 4*ПроверяемыйИНН[3]
						 + 10*ПроверяемыйИНН[4] + 3*ПроверяемыйИНН[5] + 5*ПроверяемыйИНН[6] + 9*ПроверяемыйИНН[7]
						  + 4*ПроверяемыйИНН[8] + 6*ПроверяемыйИНН[9] + 8*ПроверяемыйИНН[10]; 
		
		КонтрольныйРазряд1 = (КонтрольнаяСумма1 % 11) % 10;
		
		КонтрольныйРазряд2 = (КонтрольнаяСумма2 % 11) % 10;
		
		Если КонтрольныйРазряд1 = Число(ПроверяемыйИНН[10]) И КонтрольныйРазряд2 = Число(ПроверяемыйИНН[11]) Тогда
			Возврат Истина;	
		Иначе
			Возврат Ложь;
		КонецЕсли;
		
	КонецЕсли;

КонецФункции
```

__Процедуры__:

Процедура для заполнения полного наименования с разворачиванием распространенных сокращений организационно-правовых форм:
```bsl
Процедура НаименованиеПриИзменении(Элемент)
	
	Если АвтоИзменениеНаименования = Истина Тогда
		
		Названия = Новый Соответствие;
		Названия.Вставить("ИП", "Индивидуальный предприниматель");
		Названия.Вставить("АО","Акционерное общество");
		Названия.Вставить("ОАО","Открытое акционерное общество");
		Названия.Вставить("ЗАО","Закрытое акционерное общество");
		Названия.Вставить("ООО","Общество с ограниченной ответственностью");
		Названия.Вставить("ПАО","Публичное акционерное общество");
		
		Для каждого Элемент Из Названия Цикл
			Если СтрНачинаетсяС(Объект.Наименование, Элемент.Ключ) Тогда
				Объект.ПолноеНаименование = СтрЗаменить(Объект.Наименование, Элемент.Ключ, Элемент.Значение);
			КонецЕсли;
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры
```

Процедура для генерации случайного пароля на форме Администратора:
```bsl
Процедура СлучайныйПароль(Команда)
	
	СгенерированныйПароль = "";
	СимволыДляГенерации = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
	ГСЧ = Новый ГенераторСлучайныхЧисел();
	
	Для Н = 0 По 5 Цикл //заполняем массив случайными 6-ю знаками
		СгенерированныйПароль = СгенерированныйПароль + 
								Сред(СимволыДляГенерации, ГСЧ.СлучайноеЧисло(1,СтрДлина(СимволыДляГенерации)),1);
	КонецЦикла;
	
	Элементы.Пароль.РежимПароля = Ложь;
	Пароль = СгенерированныйПароль;
	
КонецПроцедуры
```
